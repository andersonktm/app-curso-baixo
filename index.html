<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L√≥gica do Groove - Curso de Baixo</title>

    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

    <style>
        /* Tela de Login (Cobre tudo) */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #2c3e50; z-index: 9999;
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            color: white; transition: opacity 0.5s;
        }
        .login-box { background: white; padding: 30px; border-radius: 10px; width: 300px; text-align: center; color: #333; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .login-input { width: 90%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
        .login-btn { width: 100%; padding: 12px; background: #e67e22; color: white; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; font-size: 16px; transition: 0.3s; }
        .login-btn:hover { background: #d35400; }
        .error-msg { color: #e74c3c; font-size: 14px; display: none; margin-top: 10px; font-weight: bold; }

        /* Container do App (Come√ßa invis√≠vel) */
        #app-container { 
            opacity: 0; 
            transition: opacity 1s; 
            pointer-events: none; /* Impede cliques enquanto n√£o logar */
            width: 100%; height: 100%;
        }

        /* Bot√£o de Logout na Sidebar */
        .btn-logout {
            background: #c0392b; color: white; border: none; padding: 8px 15px;
            border-radius: 4px; cursor: pointer; margin-top: 10px; width: 100%; font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h2 style="margin-top:0; color:#2c3e50;">üé∏ L√≥gica do Groove</h2>
        <p style="color:#7f8c8d; font-size:0.9rem;">√Årea Restrita a Alunos</p>
        
        <input type="email" id="email" placeholder="E-mail" class="login-input">
        <input type="password" id="senha" placeholder="Senha" class="login-input">
        
        <button class="login-btn" id="btnLogin">ENTRAR</button>
        <p id="error-msg" class="error-msg">E-mail ou senha incorretos.</p>
    </div>
</div>

<div id="app-container">

    <div id="metronome-modal">
        <div class="modal-content" style="text-align: center; padding: 20px; max-width: 700px;">
            <button class="close-modal" onclick="toggleMetronome()">X</button>
            <h2 style="color:#2c3e50; margin-top:0;">Metr√¥nomo Pro</h2>
            
            <div class="metro-controls">
                <div>
                    <label style="font-weight:bold; color:#7f8c8d;">Compasso:</label>
                    <select id="time-sig" class="metro-select" onchange="generateSteps()">
                        <option value="4/4">4/4 (Rock/Pop)</option>
                        <option value="2/4">2/4 (Samba/Polka)</option>
                        <option value="3/4">3/4 (Valsa)</option>
                        <option value="2/2">2/2 (Cut Time)</option>
                        <option value="6/8">6/8 (Blues/Jazz)</option>
                        <option value="7/4">7/4 (Prog)</option>
                    </select>
                </div>
                <div style="font-size: 2rem; font-weight: bold; color: #e67e22;">
                    <span id="bpm-val">100</span> <span style="font-size: 1rem; color: #7f8c8d;">BPM</span>
                </div>
            </div>

            <p style="font-size:0.8rem; color:#666; margin:0;">Toque nas barras: Mudo > Fraco (Roxo) > Forte (Azul)</p>
            <div id="sequencer-track" class="sequencer-container"></div>

            <input type="range" id="bpm-range" min="40" max="220" value="100" 
                   style="width: 100%; margin: 20px 0; cursor: pointer;"
                   oninput="updateBpm(this.value)">

            <button id="btn-play-metro" onclick="togglePlayMetronome()" 
                    style="background: #2c3e50; color: white; border: none; padding: 15px 50px; font-size: 1.2rem; border-radius: 50px; cursor: pointer; transition:0.2s;">
                ‚ñ∂ INICIAR
            </button>
        </div>
    </div>

    <div id="map-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center;">
        <div class="modal-content" style="width: 95%; max-width: 1000px; height: 90%; background: white; padding: 10px; border-radius: 8px; position: relative; display: flex; flex-direction: column;">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:10px;">
                <h2 style="margin:0; color:#2c3e50;">Seu Caminho de Evolu√ß√£o</h2>
                <button class="close-modal" onclick="toggleMap()" style="position:static;">X</button>
            </div>
            <div id="roadmap-container" style="flex: 1; overflow: auto; text-align: center; cursor: move;">
                <div class="mermaid" id="mermaid-graph"></div>
            </div>
            <p style="text-align:center; color:#7f8c8d; font-size:0.8rem; margin-top:5px;">Clique numa caixa para ir para a aula.</p>
        </div>
    </div>

    <div id="sidebar">
        <div class="logo-area">
            <h1>L√≥gica do Groove</h1>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞ Menu</button>
        </div>
        <div class="tools-area">
            <button class="btn-metronome" onclick="toggleMetronome()"><span>‚è±Ô∏è</span> Abrir Metr√¥nomo</button>
            <button class="btn-metronome" onclick="toggleMap()" style="background: #27ae60;"><span>üó∫Ô∏è</span> Mapa de Estudo</button>
            
            <button class="btn-logout" id="btnLogout">üö™ Sair / Logout</button>
        </div>
        <div id="menu-container"></div>
    </div>

    <div id="content">
        <div class="container">
            <div class="breadcrumb" id="display-module">M√≥dulo...</div>
            <h2 class="lesson-title" id="display-title">T√≠tulo da Aula...</h2>
            
            <div class="lesson-text" id="display-text">Selecione uma aula no menu.</div>

            <div id="study-timer" class="timer-box" style="display:none;">
                <div style="display:flex; flex-direction:column;">
                    <span style="font-size:0.8rem; text-transform:uppercase; letter-spacing:1px; opacity:0.8;">Tempo de Pr√°tica</span>
                    <span id="timer-display" class="timer-display">00:00</span>
                </div>
                <button id="btn-timer" class="timer-btn" onclick="toggleStudyTimer()">‚ñ∂ INICIAR</button>
            </div>

            <div class="image-container">
                <img id="display-img" src="" alt="Diagrama da aula" style="display:none;">
                <div id="no-image-msg" class="no-image">Sem imagem para esta aula</div>
            </div>

            <div id="audio-container" class="audio-section" style="display:none;">
                <div class="audio-row" id="row-bass">
                    <span class="audio-label">üé∏ Baixo Isolado (Refer√™ncia):</span>
                    <audio id="player-bass" controls controlsList="nodownload"><source src="" type="audio/mpeg"></audio>
                </div>
                <div class="audio-row" id="row-backing">
                    <span class="audio-label">ü•Å Backing Track (Para Praticar):</span>
                    <audio id="player-back" controls controlsList="nodownload"><source src="" type="audio/mpeg"></audio>
                </div>
            </div>

            <div class="nav-buttons">
                <button id="btn-prev" class="nav-btn" onclick="changeLesson(-1)">‚¨Ö Anterior</button>
                <button id="btn-next" class="nav-btn" onclick="changeLesson(1)">Pr√≥ximo ‚û°</button>
            </div>
        </div>
    </div>
    </div> <script src="script.js"></script>

<script type="module">
    // Importa as fun√ß√µes necess√°rias do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // --- IMPORTANTE: Substitua isso pelos dados do seu Console Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyCTJGH90GaYbdRChcjOtpff5o6ZYzlYA8k",
  authDomain: "guia-baixo-app.firebaseapp.com",
  projectId: "guia-baixo-app",
    storageBucket: "guia-baixo-app.firebasestorage.app",
    messagingSenderId: "1027874033890",
       appId: "1:1027874033890:web:61de70c26e635811ab8ebb"
    };
    // ------------------------------------------------------------------------

    // Inicializa
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Elementos da DOM
    const loginScreen = document.getElementById('login-screen');
    const appContainer = document.getElementById('app-container');
    const emailInput = document.getElementById('email');
    const passInput = document.getElementById('senha');
    const errorMsg = document.getElementById('error-msg');
    const btnLogin = document.getElementById('btnLogin');
    const btnLogout = document.getElementById('btnLogout');

    // Fun√ß√£o de Login
    btnLogin.addEventListener('click', () => {
        const email = emailInput.value;
        const pass = passInput.value;
        
        // Texto de "Carregando..."
        btnLogin.innerText = "Verificando...";
        
        signInWithEmailAndPassword(auth, email, pass)
            .then((userCredential) => {
                // Sucesso: O onAuthStateChanged vai lidar com a tela
                btnLogin.innerText = "ENTRAR";
            })
            .catch((error) => {
                btnLogin.innerText = "ENTRAR";
                errorMsg.style.display = 'block';
                // Traduzindo erros comuns para PT-BR
                if(error.code === 'auth/invalid-credential') {
                    errorMsg.innerText = "E-mail ou senha incorretos.";
                } else if(error.code === 'auth/too-many-requests') {
                    errorMsg.innerText = "Muitas tentativas. Tente mais tarde.";
                } else {
                    errorMsg.innerText = "Erro: " + error.message;
                }
            });
    });

    // Fun√ß√£o de Logout
    if(btnLogout) {
        btnLogout.addEventListener('click', () => {
            if(confirm("Deseja realmente sair?")) {
                signOut(auth);
            }
        });
    }

    // O "Vigia" - Monitora se est√° logado ou n√£o
    onAuthStateChanged(auth, (user) => {
        if (user) {
            // --- USU√ÅRIO LOGADO ---
            console.log("Usu√°rio conectado:", user.email);
            
            // Some o Login
            loginScreen.style.opacity = '0';
            setTimeout(() => { 
                loginScreen.style.display = 'none'; 
            }, 500);
            
            // Aparece o App
            appContainer.style.opacity = '1';
            appContainer.style.pointerEvents = 'all';

        } else {
            // --- USU√ÅRIO DESLOGADO ---
            console.log("Nenhum usu√°rio conectado.");
            
            // Mostra o Login
            loginScreen.style.display = 'flex';
            setTimeout(() => { loginScreen.style.opacity = '1'; }, 10);
            
            // Esconde o App
            appContainer.style.opacity = '0';
            appContainer.style.pointerEvents = 'none';
        }
    });
</script>

</body>
</html>